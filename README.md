# stack-external-worker
Deploy external workers pool for Cycloid.io

Version of Concourse worker is automatically generated by a curl on `scheduler_api_address`/api/v1/info

# Details


**Pipeline**

  * Run packer to build debian Amazon AMI exposing telegraph metrics (port 9100 prometheus format).
  * Automatically get the Concourse image version to deploy from Concourse web api url `/api/v1/info`
  * Clean old builded AMI

**Terraform**

  * Create ASG of workers

**Ansible**

  * Playbook and packer config to build a debian image with telegraf, fluentd and Concourse installed


# Deploy an external worker using Aws CloudFormation stack

Deploy using CloudFormation can be done with this url :

```
https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-west-1#/stacks/create/review
?templateURL=https://s3-eu-west-1.amazonaws.com/cycloid-cloudformation/external-worker-aws-cf-template.yaml
&stackName=cycloid-workers
&param_TeamId=...
&param_TsaPublicKey=...
```

> Internal note to refresh the file on s3 : `aws s3 cp extra/external-worker-aws-cf-template.yaml s3://cycloid-cloudformation/`
